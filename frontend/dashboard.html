<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    .app { display: flex; height: 100vh; }

    .sidebar {
      width: 220px;
      padding: 20px;
      color: white;
      background: linear-gradient(180deg, #020617, #2e1065);
    }

    .sidebar h2 { margin: 0; font-size: 22px; letter-spacing: 1px; }
    .sidebar p { color: #c7d2fe; }

    .sidebar button {
      display: block;
      width: 100%;
      margin: 12px 0;
      padding: 10px;
      background: rgba(255,255,255,0.08);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .sidebar button:hover { background: rgba(255,255,255,0.18); }

    .sidebar button.active {
      background: linear-gradient(90deg, #7c3aed, #4c1d95);
      box-shadow: 0 0 14px rgba(124,58,237,0.9);
    }

    .main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #020617;
    }

    .header {
      background: #020617;
      padding: 18px 22px;
      border-radius: 14px;
      margin-bottom: 20px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .header h1 { color: white; }
    .header p { color: #a5b4fc; }

    .box {
      background: #020617;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.05);
    }

    input, select, button {
      padding: 8px 12px;
      margin: 4px;
      border-radius: 10px;
      background: #020617;
      color: white;
      border: 1px solid #1e293b;
    }

    #taskList li, #expenseList li {
      background: #020617;
      padding: 8px 10px;
      border-radius: 10px;
      margin: 6px 0;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .income { color: #4ade80; }
    .expense { color: #f87171; }

    @media (max-width: 768px) {
      .app { flex-direction: column; }
      .sidebar { width: 100%; display: flex; gap: 10px; }
      .sidebar button { flex: 1; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="sidebar">
      <h2>DayFlow</h2>
      <p style="font-size:12px; color:#94a3b8; margin-top:2px;">Manage your day</p>

      <button id="todoBtn" onclick="showSection('todo')">To-Do</button>
      <button id="expenseBtn" onclick="showSection('expense')">Expense</button>
      <button onclick="logout()">Logout</button>
    </div>

    <div class="main">
      <div class="header">
        <h1 style="margin:0;">DayFlow</h1>
        <p style="margin:4px 0 0; font-size:14px;">Manage your day, master your life.</p>
      </div>

      <div id="todoSection" class="box">
        <h2>To-Do List</h2>
        <input id="taskInput" placeholder="Enter a task" />
        <input id="dateInput" type="date" />
        <button onclick="addTask()">Add</button>
        <ul id="taskList"></ul>
      </div>

      <div id="expenseSection" class="box" style="display:none;">
        <h2>Expense Tracker</h2>
        <h3 id="balance">Balance: 0</h3>

        <input id="amt" type="number" placeholder="Amount" />
        <input id="note" placeholder="Note" />
        <select id="etype">
          <option value="expense">Expense</option>
          <option value="income">Income</option>
        </select>
        <input id="edate" type="date" />
        <button onclick="addExpense()">Add</button>

        <ul id="expenseList"></ul>
      </div>
    </div>
  </div>

  <script>
    const API = "https://dayflow-backend-opz7.onrender.com";

    const name = localStorage.getItem("username");
    const userEmail = localStorage.getItem("userEmail");

    if (!name) window.location.href = "index.html";

    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

    // -------- TO-DO --------

    async function fetchTasks() {
      const res = await fetch(`${API}/api/tasks/${userEmail}`);
      const tasks = await res.json();

      const list = document.getElementById("taskList");
      list.innerHTML = "";

      tasks.forEach(task => {
        const li = document.createElement("li");
        const span = document.createElement("span");
        span.innerText = task.text;

        if (task.completed) {
          span.style.textDecoration = "line-through";
          span.style.color = "gray";
        }

        const doneBtn = document.createElement("button");
        doneBtn.innerText = task.completed ? "Undo" : "Done";
        doneBtn.onclick = () => toggleTask(task._id, !task.completed);

        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.onclick = () => deleteTask(task._id);

        li.appendChild(span);
        li.appendChild(doneBtn);
        li.appendChild(delBtn);
        list.appendChild(li);
      });
    }

    async function addTask() {
      const text = taskInput.value.trim();
      const deadline = dateInput.value;
      if (!text) return;

      await fetch(`${API}/api/tasks`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, userEmail, deadline })
      });

      taskInput.value = "";
      dateInput.value = "";
      fetchTasks();
    }

    async function deleteTask(id) {
      await fetch(`${API}/api/tasks/${id}`, { method: "DELETE" });
      fetchTasks();
    }

    async function toggleTask(id, newStatus) {
      await fetch(`${API}/api/tasks/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ completed: newStatus })
      });
      fetchTasks();
    }

    // -------- EXPENSE --------

    async function fetchExpenses() {
      const res = await fetch(`${API}/api/expenses/${userEmail}`);
      const data = await res.json();

      const list = document.getElementById("expenseList");
      list.innerHTML = "";

      let income = 0, expense = 0;

      data.forEach(e => {
        const li = document.createElement("li");
        li.className = e.type;

        if (e.type === "income") income += e.amount;
        else expense += e.amount;

        li.innerText = `${e.date} - ${e.note} : ${e.amount}`;

        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.onclick = () => deleteExpense(e._id);

        li.appendChild(delBtn);
        list.appendChild(li);
      });

      document.getElementById("balance").innerText =
        `Income: ${income} | Expense: ${expense} | Balance: ${income - expense}`;
    }

    async function addExpense() {
      const amount = Number(amt.value);
      const noteText = note.value.trim();
      const type = etype.value;
      const date = edate.value;

      if (!amount || !noteText || !date) return;

      await fetch(`${API}/api/expenses`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, note: noteText, type, userEmail, date })
      });

      amt.value = "";
      note.value = "";
      edate.value = "";
      fetchExpenses();
    }

    async function deleteExpense(id) {
      await fetch(`${API}/api/expenses/${id}`, { method: "DELETE" });
      fetchExpenses();
    }

    function showSection(name) {
      todoSection.style.display = name === "todo" ? "block" : "none";
      expenseSection.style.display = name === "expense" ? "block" : "none";

      todoBtn.classList.toggle("active", name === "todo");
      expenseBtn.classList.toggle("active", name === "expense");
    }

    showSection("todo");
    fetchTasks();
    fetchExpenses();
  </script>
</body>
</html>
<!--redeploy-->